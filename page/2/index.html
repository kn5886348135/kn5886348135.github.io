<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.goodserendipity.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="缘分天注定">
<meta property="og:url" content="https://www.goodserendipity.com/page/2/index.html">
<meta property="og:site_name" content="缘分天注定">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Louis">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.goodserendipity.com/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>缘分天注定</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">缘分天注定</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">古之立大事者，不惟有超世之才，亦必有坚忍不拔之志</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/29%E3%80%81Suffix%20array/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/29%E3%80%81Suffix%20array/" class="post-title-link" itemprop="url">Suffix Array</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:43:52" itemprop="dateCreated datePublished" datetime="2023-06-03T01:43:52+08:00">2023-06-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/28%E3%80%81Skip%20List/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/28%E3%80%81Skip%20List/" class="post-title-link" itemprop="url">Skip List</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-06-03 01:40:13 / Modified: 01:41:00" itemprop="dateCreated datePublished" datetime="2023-06-03T01:40:13+08:00">2023-06-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>跳表（skiplist）<br />
1）结构上根本和搜索二叉树无关<br />
2）利用随机概率分布来使得高层索引可以无视数据规律，做到整体性能优良<br />
3）思想是所有有序表中最先进的<br />
4）结构简单就是多级单链表</p>
<p>聊聊红黑树<br />
1）平衡性规定非常诡异<br />
2）平衡性调整最为复杂<br />
3）优点在于每次插入删除扰动较好，但是在今天看来这个优势也极其微弱了<br />
原因：贪图扰动小的话，B+树、2-3-4树可能更好，还是那句话，到底图什么<br />
4）除此之外，红黑树并不比AVL树、SB树、跳表更加优秀<br />
5）面试上遇到，说清楚道理，不行就举报</p>
<p>数组、hashmap等扩容的时间复杂度均摊下来就是O(1)<br />
234树、B树、B+树、红黑树等平衡性相对不严格，只需要在调整平衡性的时候进行磁盘IO，用于硬盘相关，主要减少磁盘IO，而AVL Tree平衡性好，但是对磁盘IO比较敏感</p>
<p>插入删除、查询的时间复杂度都是O(logN)，严格证明涉及概率。</p>
<p>题目一<br />
给定一个数组arr，和两个整数a和b（a&lt;=b）<br />
求arr中有多少个子数组，累加和在[a,b]这个范围上<br />
返回达标的子数组数量<br />
归并排序、前缀和数组、暴力O(N<sup>3</sup>)、改写SBT</p>
<p>题目二<br />
有一个滑动窗口（讲过的）：<br />
1）L是滑动窗口最左位置、R是滑动窗口最右位置，一开始LR都在数组左侧<br />
2）任何一步都可能R往右动，表示某个数进了窗口<br />
3）任何一步都可能L往右动，表示某个数出了窗口</p>
<p>想知道每一个窗口状态的中位数</p>
<p>题目三</p>
<p>设计一个结构包含如下两个方法：<br />
void add(int index, int num)：把num加入到index位置<br />
int get(int index) ：取出index位置的值<br />
void remove(int index) ：把index位置上的值删除<br />
要求三个方法时间复杂度O(logN)</p>
<p>改写有序表的题目核心点<br />
1）分析增加什么数据项可以支持题目<br />
2）有序表一定要保持内部参与排序的key不重复<br />
3）增加这个数据项了，在平衡性调整时，保证这个数据项也能更新正确<br />
4）做到上面3点，剩下就是搜索二叉树怎么实现你想要的接口的问题了</p>
<p>红黑树的定义<br />
1、头结点黑<br />
2、叶子节点黑<br />
3、紅色节点不能相连</p>
<p>最长链红黑相间，最短链都是黑长度相差不超过两倍<br />
增加节点5中违规、删除节点8中违规</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/27%E3%80%81Size%20Balanced%20Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/27%E3%80%81Size%20Balanced%20Tree/" class="post-title-link" itemprop="url">Size Balanced Tree</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-06-03 01:36:47 / Modified: 01:38:31" itemprop="dateCreated datePublished" datetime="2023-06-03T01:36:47+08:00">2023-06-03</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>SB树（size-balance-tree）<br />
1）让每一个叔叔节点为头的数，节点个数都不少于其任何一个侄子节点<br />
2）也是从底层被影响节点开始向上做路径每个节点检查<br />
3）与AVL树非常像，也是四种违规类型：LL、RR、LR、RL<br />
4）与AVL树非常像，核心点是：<br />
LL（做一次右旋）、RR（做一次左旋）<br />
LR和RL（利用旋转让底层那个上到顶部）<br />
5）与AVL树不同的是，每轮经过调整后，谁的孩子发生变化了，谁就再查</p>
<p>SB树在使用时候的改进<br />
1）删除时候可以不用检查<br />
2）就把平衡性的调整放在插入的时候<br />
3）因为这种只要变就递归的特性，别的树没有<br />
4）可以在节点上封装别的数据项，来增加功能</p>
<p>跳表（skiplist）</p>
<p>1）结构上根本和搜索二叉树无关</p>
<p>2）利用随机概率分布来使得高层索引可以无视数据规律，做到整体性能优良</p>
<p>3）思想是所有有序表中最先进的</p>
<p>4）结构简单就是多级单链表</p>
<p>聊聊红黑树</p>
<p>1）平衡性规定非常诡异<br />
2）平衡性调整最为复杂<br />
3）优点在于每次插入删除扰动较好，但是在今天看来这个优势也极其微弱了<br />
原因：贪图扰动小的话，B+树、2-3-4树可能更好，还是那句话，到底图什么<br />
4）除此之外，红黑树并不比AVL树、SB树、跳表更加优秀<br />
5）面试上遇到，说清楚道理，不行就举报</p>
<p></br></br></br></br><br />
平衡性<br />
size(T.left) ≥ size(T.right.left), size(T.right.right)<br />
size(T.right) ≥ size(T.left.left), size(T.left.right)<br />
假设size(A)=n，AB是左右两个子节点，则size(B)&lt;=2n。则整颗树的高度仍然是logN的水平，没有avl tree的平衡性好。<br />
破坏平衡性的4种类型<br />
当前节点cur<br />
left、right都是指初始状态的左右节点，而不是调整以后的。<br />
LL      size(cur.left.left)&gt;size(cur.right) cur右旋并递归检查cur,cur.left是否违规<br />
LR      size(cur.left.right)&gt;size(cur.right) cur.left左旋，cur.left.right右旋，并递归检查cur、cur.left、cur.left.right<br />
RL      size(cur.right.left)&gt;size(cur.left) cur.right右旋，cur.right.left左旋，并递归检查cur、cur.right、cur.right.left<br />
RR      size(cur.right.right)&gt;size(cur.left) cur左旋并递归检查cur,cur.right</p>
<p>avl tree的平衡性很严苛，每次添加、删除节点都会检查。<br />
size-balanced tree只能保证两个子树的size不超过2倍，时间复杂度有严格的数学证明，O(logN)<br />
size-balanced tree的优势<br />
删除节点的时候不调整平衡性，只在增加节点的时候递归调整<br />
假设size-balanced tree的节点数是N，删除所有的左节点或者右节点后退化成链表时，高度为logN，是最差时间复杂度。后续如果增加节点，马上递归调整成平衡状态。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/26%E3%80%81AVL%20tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/26%E3%80%81AVL%20tree/" class="post-title-link" itemprop="url">AVL tree</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:33:10" itemprop="dateCreated datePublished" datetime="2023-06-03T01:33:10+08:00">2023-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-24 00:48:45" itemprop="dateModified" datetime="2023-07-24T00:48:45+08:00">2023-07-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>搜索二叉树<br />
搜索二叉树一定要说明以什么标准来排序<br />
经典的搜索二叉树，树上没有重复的用来排序的key值<br />
如果有重复节点的需求，可以在一个节点内部增加数据项</p>
<p>搜索二叉树查询key（查询某个key存在还是不存在）<br />
1）如果当前节点的value==key，返回true<br />
2）如果当前节点的value &lt; key，当前节点向左移动<br />
3）如果当前节点的value &gt; key，当前节点向右移动<br />
4）如果当前节点变成null，返回false</p>
<p>搜索二叉树插入新的key<br />
和查询过程一样，但当前节点滑到空的时候，就插入在这里</p>
<p>搜索二叉树删除key<br />
0）先找到key所在的节点<br />
1）如果该节点没有左孩子、没有右孩子，直接删除即可<br />
2）如果该节点有左孩子、没有右孩子，直接用左孩子顶替该节点<br />
3）如果该节点没有左孩子、有右孩子，直接用右孩子顶替该节点<br />
4）如果该节点有左孩子、有右孩子，用该节点后继节点顶替该节点</p>
<p>搜索二叉树特别不讲究<br />
1）基础的搜索二叉树，添加、删除时候不照顾平衡性<br />
2）数据状况很差时，性能就很差<br />
给搜索二叉树引入两个动作：左旋、右旋</p>
<p>AVL树、SB树、红黑树的共性<br />
1）都是搜索二叉树<br />
2）插入、删除、查询（一切查询）搜索二叉树怎么做，这些结构都这么做<br />
3）使用调整的基本动作都只有左旋、右旋<br />
4）插入、删除时，从最底层被影响到的节点开始，对往上路径的节点做平衡性检查<br />
5）因为只对一条向上路径的每个节点做O(1)的检查和调整，所以可以做到O(logN)</p>
<p>AVL树、SB树、红黑树的不同<br />
1）平衡性的约束不同<br />
AVL树最严格、SB树稍宽松、红黑树最宽松<br />
2）插入、删除和搜索二叉树一样，但是额外，做各自的平衡性调整。各自的平衡性调整所使用的动作都是左旋或者右旋</p>
<p>AVL树<br />
1）最严格的平衡性，任何节点左树高度和右树高度差不超过1<br />
2）往上沿途检查每个节点时，都去检查四种违规情况：LL、RR、LR、RL<br />
3）不同情况虽然看起来复杂，但是核心点是：<br />
LL（做一次右旋）、RR（做一次左旋）<br />
LR和RL（利用旋转让底层那个上到顶部）</p>
<p>AVL Tree的定义<br />
任何一个节点，左右子树的高度差小于2</p>
<p>主席树、234树、SB树、红黑树、avl树的平衡性不一样，时间复杂度都是O(<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>N</mi></mrow><annotation encoding="application/x-tex">log_2 N</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.8888799999999999em;vertical-align:-0.19444em;"></span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span></span></span></span>)。</p>
<p>搜索二叉树增加、删除节点后的操作？<br />
增加节点<br />
1、<br />
2、</p>
<p>删除节点<br />
没有左右    父节点直接指向空<br />
有左无右    父节点指向左节点<br />
有右无左    父节点指向右节点<br />
有左有右    右节点的最左节点替换当前节点或者左节点的最右节点替换当前节点</p>
<p>avl树和搜索二叉树的区别？<br />
加入节点<br />
LL、LR、RR、RL四种破坏平衡性的类型<br />
LL      左子树的左子树太长，当前节点右旋<br />
LR      左子树的右子树太长，当前节点的左子树左旋，然后右旋，使左节点的右节点来到当前节点<br />
RR      右子树的右子树太长，当前节点左旋<br />
RL      右子树的左子树太长，当前节点的右子树右旋，然后左旋，使右节点的左节点来到当前节点<br />
LL+LR   按照LL处理，直接右旋，按照LR处理可能高度差仍然大于2<br />
RR+RL   按照RR处理，直接左旋<br />
某一个节点不平衡都是上面4种类型之一，所有父节点全部检查一次</p>
<p>删除节点<br />
没有左右    父节点往上都检查<br />
有左无右    父节点指向左节点X，X往上都检查<br />
有右无左    父节点指向右节点X，X往上都检查<br />
有左有右    右节点的最左节点X替换当前节点，X的父节点往上检查或者左节点的最右节点X替换当前节点，X的父节点往上检查</p>
<p>mysql等关系数据库用到的有序表比如B+Tree无法拆分成分布式结构，所有都是单实例的。<br />
mysql8的分布式功能怎么理解？</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/02/DataStructuresAndAlgorithms/25%E3%80%81%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E7%B1%BB%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/02/DataStructuresAndAlgorithms/25%E3%80%81%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E7%B1%BB%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">资源限制类问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-02 22:04:53" itemprop="dateCreated datePublished" datetime="2023-06-02T22:04:53+08:00">2023-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-06-03 01:30:44" itemprop="dateModified" datetime="2023-06-03T01:30:44+08:00">2023-06-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="资源限制类问题技巧"><a class="markdownIt-Anchor" href="#资源限制类问题技巧"></a> 资源限制类问题技巧</h3>
<ol>
<li>布隆过滤器用于集合的建立与查询，并可以节省大量空间</li>
<li>一致性哈希解决数据服务器的负载管理问题</li>
<li>利用并查集结构做岛问题的并行计算</li>
<li>哈希函数可以把数据按照种类均匀分流</li>
<li>位图解决某一范围上数字的出现情况，并可以节省大量空间</li>
<li>利用分段统计思想、并进一步节省大量空间</li>
<li>利用堆、外排序来做多个处理单元的结果合并</li>
</ol>
<h4 id="hash函数把数据按照种类均匀分流"><a class="markdownIt-Anchor" href="#hash函数把数据按照种类均匀分流"></a> hash函数把数据按照种类均匀分流</h4>
<ol>
<li>32位无符号整数的范围是0~4,294,967,295，现在有一个正好包含40亿个无符号整数的文件，可以使用最多1GB的内存，怎么找到出现次数最多的数？</li>
</ol>
<p>  将每一个数对400取模，分别存到400个小文件中。相同的数一定在同一个文件中，并且因为hash的均匀离散特性，每个文件中最多1000W数据(即使超过1000W，也不会超过太多)，内存不超过1G。<br />
另外新建小文件记录每个数和出现的次数的键值对。取出每一个文件中出现次数最多的数，取最大值。</p>
<ol start="2">
<li>在上一个问题中，如果某一个数字出现了2000W次？</li>
</ol>
<p>  将每一个数对400取模后直接写入整数和它出现的次数的键值对，取出每一个文件中出现次数最多的数，取最大值。</p>
<h4 id="位图找出不存在的无符号整数"><a class="markdownIt-Anchor" href="#位图找出不存在的无符号整数"></a> 位图找出不存在的无符号整数</h4>
<ol start="3">
<li>32位无符号整数的范围是0~4,294,967,295，现在有一个正好包含40亿个无符号整数的文件，所以在整个范围中必然存在没出现过的数。可以使用最多1GB的内存，怎么找到所有未出现过的数？</li>
</ol>
<p>  使用bitmap或者数组保存0~4,294,967,295内的无符号整数，1GB=2<sup>3</sup> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 2<sup>10</sup> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 2<sup>10</sup> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 2<sup>10</sup> bit = 2<sup>33</sup> bit，是可以保存所有0~4,294,967,295的无符号整数。遍历给定的文件，拿到某一个整数index，在bitmap的offset为index的二进制位修改为1，最后取出bitmap中所有二进制位为0的数，bitmap的所有二进制位都是0则是整数0。(2<sup>32</sup>长度的bit数组arr，出现过的数字num，将arr[num]标记成1，最后将没有出现过的数字列出即可。如果arr[index]==0，则index没有出现过。)<br />
  Set，需要约16G内存，位图，不超过1G内存。2<sup>32</sup>     bit = 2<sup>29</sup>     Byte = 2<sup>19</sup>     KB = 2<sup>9</sup>      MB = 2<sup>-1</sup>     GB</p>
<ol start="4">
<li>32位无符号整数的范围是0~4294967295，现在有40亿个无符号整数，可以使用最多1GB的内存，找出所有出现了两次的数。</li>
</ol>
<p>  准备2<sup>33</sup>长度的bit数组arr，对任意无符号整数index，arr[2<em>index]、arr[2</em>index+1]表示index出现的次数</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>arr[2 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> index]</th>
<th>arr[2 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> index + 1]</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>没有出现index</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>1</td>
<td>index出现1次</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>0</td>
<td>index出现2次</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>1</td>
<td>index出现3次及以上</td>
</tr>
</tbody>
</table>
<h4 id="分段统计"><a class="markdownIt-Anchor" href="#分段统计"></a> 分段统计</h4>
<ol start="5">
<li>32位无符号整数的范围是0~4,294,967,295，现在有一个正好包含40亿个无符号整数的文件，所以在整个范围中必然存在没出现过的数。内存限制为 10MB(3KB)，怎么找到任意一个没有出现的整数。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设数组长度为10</span></span><br><span class="line"><span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">179</span>; <span class="comment">// i &amp;lt; 10 * 32</span></span><br><span class="line"><span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> (arr[i / <span class="number">32</span>] &amp; (<span class="number">1</span> &lt;&lt; (i % <span class="number">32</span>))) == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>  程序运行消耗的内存肯定不止3KB，这里的3KB是指用于分段的局部变量内存大小。<br />
  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>512</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">512 \times 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span> Byte &lt; 3KB，将0-2<sup>32</sup>-1均分成512份，则每一份都应该有2<sup>23</sup> = 8388608个无符号整数。准备数组arr，遍历整个文件，当前无符号整数num对512取模，结果为index，arr[index]记录每一个分段的无符号整数的个数。根据鸽笼原理，必有某一个arr[i]小于2<sup>23</sup>。继续拆分成512份，适当时候可以使用bitmap找到一个没有出现的无符号整数。</p>
<p>  0~2<sup>32</sup>-1一共2<sup>32</sup>个数字，每个比特位为1和为0的无符号整数个数一定是相同的。遍历40亿个无符号整数，从最高位开始，每次取个数较小的比特位并记录。最多32次就可以获取某一个不存在的无符号整数。<br />
// TODO 证明</p>
<ol start="6">
<li>只能申请几个有限的变量，找到40亿个数的文件中没有出现的(1-2<sup>32</sup>-1)范围内的数字？<br />
  准备left、mid、right将2<sup>32</sup>二分，个数较少的那部分一定有不存在的无符号整数。最多经过32次二分就可以得出结果。</li>
</ol>
<h3 id="布隆过滤器"><a class="markdownIt-Anchor" href="#布隆过滤器"></a> 布隆过滤器</h3>
<ol start="7">
<li>有一个包含100亿个URL的大文件，假设每个URL占用64Bit，请找出其中所有重复的URL。</li>
</ol>
<p>  布隆过滤器存在误判的可能，hash签名不会误判但需要更多的内存。将所有URL通过一到两次hash到若干个(10000)小文件中，最后统计小文件中重复的URL。</p>
<ol start="8">
<li>某搜索公司一天的用户搜索词汇是海量的(百亿数据量)，请设计一种求出每天热门Top100词汇的可行办法。</li>
</ol>
<p>  大根堆是不可以的，没法获取每一个搜索词汇的频次，100亿URL的大根堆超过单机处理内存上限。<br />
可以使用hash或者布隆过滤器拿到所有搜索词出现的次数，再取出top100。</p>
<h3 id="分段统计-2"><a class="markdownIt-Anchor" href="#分段统计-2"></a> 分段统计</h3>
<ol start="9">
<li>
<p>32位无符号整数的范围是0~4294967295，现在有40亿个无符号整数，可以使用最多3K的内存，怎么找到这40亿个整数的中位数？<br />
1、准备int[] arr = new int[512]<br />
2、统计将40亿个数按照512个一组分成若干份，统计每一组的频次<br />
3、累加每组的频次，直到20亿</p>
</li>
<li>
<p>32位无符号整数的范围是0~4294967295，现在有40亿个无符号整数，可以使用最多3K的内存，怎么找到这40亿个整数的上中位数(偶数个的时候前一个)？<br />
1、准备int[] arr = new int[512]<br />
2、统计将40亿个数按照512个一组分成若干份，统计每一组的频次<br />
3、累加每组的频次，直到20亿</p>
</li>
</ol>
<h3 id="堆排序"><a class="markdownIt-Anchor" href="#堆排序"></a> 堆排序</h3>
<ol start="11">
<li>32位无符号整数的范围是0~4294967295，有一个10G大小的文件，每一行都装着这种类型的数字，整个文件是无序的，给你5G的内存空间，请你输出一个10G大小的文件，就是原文件所有数字排序的结果。</li>
</ol>
<p>  用自定义的堆或者数组保存前k个最小的无符号整数并排序，记录每个整数和出现的次数的键值对。若干次循环将整个文件的无符号整数排序。外部排序(分布式合并排序)可以忽视单机内存限制，二项堆(堆上堆、二维堆)也有单机内存限制。</p>
<ol>
<li>将源文件复制一份</li>
<li>自定义一个小根堆，大小为2<sup>28</sup>次，正好1GB大小的Integer数据</li>
<li>从文件中读取逐行读取数字<br />
a. 如果堆没有满则进堆，在文件中删除这个数字，并记录数字和对应的频次<br />
b. 如果堆满并且小于堆中最大的数则进堆并且删除堆中最大的数，在文件中删除这个数字，并记录数字和对应的频次。更新堆中最大的数和位置。<br />
c. 如果堆满并且大于堆中的最大的数则继续读取文件中的数字并重复步骤3</li>
<li>文件读取完以后将堆中的数字读出并按照频次输出到目标文件</li>
<li>循环步骤3、4直到文件中没有数据</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/05/31/Emacs/Emacs%E9%85%8D%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/Emacs/Emacs%E9%85%8D%E7%BD%AE/" class="post-title-link" itemprop="url">emacs插件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-31 20:53:25" itemprop="dateCreated datePublished" datetime="2023-05-31T20:53:25+08:00">2023-05-31</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-06-02 21:30:20" itemprop="dateModified" datetime="2023-06-02T21:30:20+08:00">2023-06-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/emacs/" itemprop="url" rel="index"><span itemprop="name">emacs</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  <a target="_blank" rel="noopener" href="https://www.gnu.org/software/emacs/">Emacs</a>是一个可扩展的、可自定义、自由的文本编辑器(<s>肝帝快来</s>)，其核心是 Emacs Lisp 的解释器，这是 Lisp 编程语言的一种方言，具有支持文本编辑的扩展。<br />
  <a target="_blank" rel="noopener" href="https://www.msys2.org/">MSYS2</a>是一个工具和库的集合，为您提供了一个易于使用的环境来构建、安装和运行本机 Windows 软件。在安装一些Emacs插件的时候会很方便。<br />
  可以使用benchmark-init测试启动耗时，然后进行有针对性的优化。<br />
  将配置文件放到~/.emacs.d(windows系统为C:\Users\username\AppData\Roaming.emacs.d)目录，自动加载。主流开源配置</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.spacemacs.org/">Spacemacs</a></li>
<li>Centaur Emacs</li>
<li>Doom Emacs</li>
<li>Steve Purcell</li>
<li>redguardtoo</li>
<li><a target="_blank" rel="noopener" href="https://github.com/emacs-tw/awesome-emacs">Awesome Emacs</a></li>
</ul>
<p>Writing GNU Emacs Extensions</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/05/31/Linux/network/TcpConnectionStatus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/Linux/network/TcpConnectionStatus/" class="post-title-link" itemprop="url">tcp connection status</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-31 17:36:47 / Modified: 20:50:02" itemprop="dateCreated datePublished" datetime="2023-05-31T17:36:47+08:00">2023-05-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  <a target="_blank" rel="noopener" href="https://www.ibm.com/docs/en/zos/2.1.0?topic=SSLTBW_2.1.0/com.ibm.zos.v2r1.halu101/constatus.html">原文连接</a>。<br />
  <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP</a> 连接在其生命周期中会经历一系列状态。下图说明了 TCP 连接的可能状态以及状态如何根据来自网络或本地 TCP 套接字应用程序的各种事件进行转换。<br />
<img src="https://www.goodserendipity.com/asserts/linux/network/dwgl0004.gif" alt="tcp连接状态" /></p>
<hr />
<ul>
<li>SYN: (同步序列编号,Synchronize Sequence Numbers)该标志仅在三次握手建立TCP连接时有效。表示一个新的TCP连接请求。</li>
<li>ACK: (确认编号,Acknowledgement Number)是对TCP请求的确认标志,同时提示对端系统已经成功接收所有数据。</li>
<li>FIN: (结束标志,FINish)用来结束一个TCP回话.但对应端口仍处于开放状态,准备接收后续数据。</li>
</ul>
<h3 id="tcp连接状态描述"><a class="markdownIt-Anchor" href="#tcp连接状态描述"></a> TCP连接状态描述</h3>
<table>
<thead>
<tr>
<th>TCP  连接状态</th>
<th>MVS™ 控制台缩写</th>
<th>TSO或者UNIX shell缩写</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>LISTEN</td>
<td>Listen</td>
<td>Listen</td>
<td>等待来自远程 TCP 应用程序的连接请求。这是您可以找到本地 TCP 服务器的侦听套接字的状态。</td>
</tr>
<tr>
<td>SYN-SENT</td>
<td>SynSent</td>
<td>SynSent</td>
<td>发送连接请求后等待来自远程端点的确认, 三次 TCP 握手的第 1 步后的结果。</td>
</tr>
<tr>
<td>SYN-RECEIVED</td>
<td>SynRcvd</td>
<td>SynRcvd</td>
<td>此端点已收到连接请求并发送确认，此端点正在等待其他端点确实收到此端点对原始连接请求的确认的最终确认。 三次 TCP 握手的第 2 步后的结果。</td>
</tr>
<tr>
<td>ESTABLISHED</td>
<td>Estblsh</td>
<td>Establsh</td>
<td>代表一个完全建立的连接； 这是连接数据传输阶段的正常状态。</td>
</tr>
<tr>
<td>FIN-WAIT-1</td>
<td>FinWt1</td>
<td>FinWait1</td>
<td>等待连接终止请求的确认或来自远程 TCP 的同步连接终止请求。 这种状态通常持续时间很短。</td>
</tr>
<tr>
<td>FIN-WAIT-2</td>
<td>FinWt2</td>
<td>FinWait2</td>
<td>在此端点发送其连接终止请求后，等待来自远程 TCP 的连接终止请求。 此状态通常持续时间很短，但如果远程套接字端点在收到此套接字端点关闭连接的信息后不久没有关闭其套接字，则它可能会持续一段时间。 过多的 FIN-WAIT-2 状态可能表示远程应用程序的编码错误。</td>
</tr>
<tr>
<td>CLOSE-WAIT</td>
<td>ClosWt</td>
<td>ClosWait</td>
<td>此端点已收到来自远程端点的关闭请求，此 TCP 现在正在等待来自本地应用程序的连接终止请求。</td>
</tr>
<tr>
<td>CLOSING</td>
<td>Closing</td>
<td>Closing</td>
<td>等待来自远程 TCP 的连接终止请求确认。 当此端点收到来自本地应用程序的关闭请求，向远程端点发送终止请求，并在收到来自远程端点的确认之前收到终止请求时，进入此状态。</td>
</tr>
<tr>
<td>LAST-ACK</td>
<td>LastAck</td>
<td>LastAck</td>
<td>等待对先前发送到远程 TCP 的连接终止请求的确认。 当此端点在发送其终止请求之前收到终止请求时，将进入此状态。</td>
</tr>
<tr>
<td>TIME-WAIT</td>
<td>TimeWt</td>
<td>TimeWait</td>
<td>等待足够的时间以确保远程 TCP 收到其连接终止请求的确认。</td>
</tr>
<tr>
<td>CLOSED</td>
<td>Closed</td>
<td>Closed</td>
<td>表示完全没有连接状态</td>
</tr>
</tbody>
</table>
<p>  TCP三次握手、四次挥手<br />
<img src="https://www.goodserendipity.com/asserts/linux/network/packet-exchange-for-tcp-connection.webp" alt="tcp连接数据包交换" /></p>
<h3 id="linux系统tcp相关参数"><a class="markdownIt-Anchor" href="#linux系统tcp相关参数"></a> Linux系统TCP相关参数</h3>
<ul>
<li>tcp_keepalive_time<br />
整型，开启keepalive后，TCP发送保活消息的频率，默认2小时</li>
<li>tcp_keepalive_probes<br />
整型，TCP 发送了多少个保活探针，直到它决定连接断开，默认9个。</li>
<li>tcp_keepalive_intvl<br />
整型，发送探针的频率。探针开启后，到乘以探针数量的时间内，杀死没有响应的连接。默认75秒，尝试11分钟后会终止。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/05/31/Linux/network/ss/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/Linux/network/ss/" class="post-title-link" itemprop="url">ss</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-31 15:50:13 / Modified: 20:47:06" itemprop="dateCreated datePublished" datetime="2023-05-31T15:50:13+08:00">2023-05-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h3>
<p>  ss用于转储套接字统计信息。它允许显示类似于netstat的信息，但是比其他工具显示更多的TCP和状态信息。</p>
<h3 id="ss的语法"><a class="markdownIt-Anchor" href="#ss的语法"></a> ss的语法</h3>
<p>  ss [options] [ FILTER ]</p>
<h3 id="ss的参数"><a class="markdownIt-Anchor" href="#ss的参数"></a> ss的参数</h3>
<p>  当没有使用options时，ss 显示已建立连接的打开的非监听套接字列表（例如 TCP/UNIX/UDP）。</p>
<p>  OPTIONS列表</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>简写</th>
<th>命令</th>
<th>作用</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>-h</td>
<td>–help</td>
<td>显示帮助页面</td>
</tr>
<tr>
<td>2</td>
<td>-V</td>
<td>–version</td>
<td>输出版本信息</td>
</tr>
<tr>
<td>3</td>
<td>-H</td>
<td>–no-header</td>
<td>不输出表头</td>
</tr>
<tr>
<td>4</td>
<td>-n</td>
<td>–numeric</td>
<td>以数字显示，不显示服务名</td>
</tr>
<tr>
<td>5</td>
<td>-r</td>
<td>–resolve</td>
<td>尝试解析IP、端口</td>
</tr>
<tr>
<td>6</td>
<td>-a</td>
<td>–all</td>
<td>输出监听和非监听套接字(对TCP是已建立连接)</td>
</tr>
<tr>
<td>7</td>
<td>-l</td>
<td>–listening</td>
<td>输出监听套接字(默认触发)</td>
</tr>
<tr>
<td>8</td>
<td>-o</td>
<td>–options</td>
<td>输出时间信息，输出格式timer:(timer_name,expire_time,retrans)</td>
</tr>
<tr>
<td>9</td>
<td>-e</td>
<td>–extended</td>
<td>输出详细的socket信息，<br>格式uid:&lt;uid_number&gt; ino:&lt;inode_number&gt; sk:<cookie></td>
</tr>
<tr>
<td>10</td>
<td>-m</td>
<td>–memory</td>
<td>输出套接字占用的内存</td>
</tr>
<tr>
<td>11</td>
<td>-p</td>
<td>–processes</td>
<td>输出使用套接字的进程</td>
</tr>
<tr>
<td>12</td>
<td>-i</td>
<td>–info</td>
<td>输出内部TCP信息</td>
</tr>
<tr>
<td>13</td>
<td>-K</td>
<td>–kill</td>
<td>尝试强制关闭套接字，输出成功关闭的套接字，跳过内核不支持关闭的套接字，仅支持IPv4和IPv6</td>
</tr>
<tr>
<td>14</td>
<td>-s</td>
<td>–summary</td>
<td>打印汇总统计信息。 此选项不解析从各种来源获取摘要的套接字列表。 当套接字数量如此之大以至于解析 /proc/net/tcp 很痛苦时，它很有用。</td>
</tr>
<tr>
<td>15</td>
<td>-E</td>
<td>–events</td>
<td>在套接字被销毁时继续显示套接字</td>
</tr>
<tr>
<td>16</td>
<td>-Z</td>
<td>–context</td>
<td>作为 -p 选项，还显示进程安全上下文。</td>
</tr>
<tr>
<td>17</td>
<td>-z</td>
<td>–contexts</td>
<td>作为-Z 选项还显示套接字上下文。 套接字上下文取自关联的 inode，而不是内核持有的实际套接字上下文。 套接字通常标有创建过程的上下文，但是显示的上下文将反映应用的任何策略角色、类型和/或范围转换规则，因此是一个有用的参考。</td>
</tr>
<tr>
<td>18</td>
<td>-N NSNAME</td>
<td>–net=NSNAME</td>
<td>切换到指定的网络命名空间名称。</td>
</tr>
<tr>
<td>19</td>
<td>-b</td>
<td>–bpf</td>
<td>显示套接字 BPF 过滤器（只允许管理员获取这些信息）。</td>
</tr>
<tr>
<td>20</td>
<td>-4</td>
<td>–ipv4</td>
<td>仅显示IPv4套接字</td>
</tr>
<tr>
<td>21</td>
<td>-6</td>
<td>–ipv6</td>
<td>仅显示IPv6套接字</td>
</tr>
<tr>
<td>22</td>
<td>-0</td>
<td>–packet</td>
<td>显示packet套接字</td>
</tr>
<tr>
<td>23</td>
<td>-t</td>
<td>–tcp</td>
<td>显示tcp套接字</td>
</tr>
<tr>
<td>24</td>
<td>-u</td>
<td>–udp</td>
<td>显示udp套接字</td>
</tr>
<tr>
<td>25</td>
<td>-d</td>
<td>–dccp</td>
<td>显示DCCP套接字</td>
</tr>
<tr>
<td>26</td>
<td>-w</td>
<td>–raw</td>
<td>显示RAW套接字</td>
</tr>
<tr>
<td>27</td>
<td>-x</td>
<td>–unix</td>
<td>显示Unix域套接字</td>
</tr>
<tr>
<td>28</td>
<td>-S</td>
<td>–sctp</td>
<td>显示SCTP套接字</td>
</tr>
<tr>
<td>29</td>
<td>–vsock</td>
<td></td>
<td>显示vsock套接字</td>
</tr>
<tr>
<td>30</td>
<td>-f FAMILY</td>
<td>–family=FAMILY</td>
<td>显示FAMILY类型套接字，当前支持unix,inet,inet6,link,netlink,vsock</td>
</tr>
<tr>
<td>31</td>
<td>-A QUERY</td>
<td>–query=QUERY, --socket=QUERY</td>
<td>要转储的套接字表列表，由命令分隔。 可以理解以下标识符：all、inet、tcp、udp、raw、unix、packet、netlink、unix_dgram、unix_stream、unix_seqpacket、packet_raw、packet_dgram、dccp、sctp、vsock_stream、vsock_dgram。 列表中的任何项目都可以选择以感叹号 (!) 为前缀，以排除该套接字表被转储。</td>
</tr>
<tr>
<td>32</td>
<td>-D FILE</td>
<td>–diag=FILE</td>
<td>不显示任何内容，只是在应用过滤器后将有关 TCP 套接字的原始信息转储到 FILE。 如果 FILE 是 - 使用标准输出。</td>
</tr>
<tr>
<td>33</td>
<td>-F FILE</td>
<td>–filter=FILE</td>
<td>从 FILE 中读取过滤器信息。 FILE 的每一行都被解释为单个命令行选项。 如果 FILE 是 - 使用标准输入。</td>
</tr>
</tbody>
</table>
<h3 id="state-filter"><a class="markdownIt-Anchor" href="#state-filter"></a> STATE-FILTER</h3>
<p>  STATE-FILTER 允许构造任意一组状态来匹配。 它的语法是关键字 state 和 exclude 的序列，后跟状态标识符。<br />
  可用的标志符，所有标准的TCP状态established, syn-sent, syn-recv, fin-wait-1, fin-wait-2, time-wait, closed, close-wait, last-ack, listening  and  clos‐ing.</p>
<ol>
<li>all - for all the states</li>
<li>connected - all the states except for listening and closed</li>
<li>synchronized - all the connected states except for syn-sent</li>
<li>bucket - states, which are maintained as minisockets, i.e.  time-wait and syn-recv</li>
<li>big - opposite to bucket</li>
</ol>
<h3 id="用例"><a class="markdownIt-Anchor" href="#用例"></a> 用例</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Display all TCP sockets.</span></span><br><span class="line">ss -t -a</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Display all TCP sockets with process SELinux security contexts.</span></span><br><span class="line">ss -t -a -Z</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Display all UDP sockets.</span></span><br><span class="line">ss -u -a</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Display all established ssh connections.</span></span><br><span class="line">ss -o state established &#x27;( dport = :ssh or sport = :ssh )&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">Find all <span class="built_in">local</span> processes connected to X server.</span></span><br><span class="line">ss -x src /tmp/.X11-unix/*</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">List all the tcp sockets <span class="keyword">in</span> state FIN-WAIT-1 <span class="keyword">for</span> our apache to network 193.233.7/24 and look at their timers.</span></span><br><span class="line">ss -o state fin-wait-1 &#x27;( sport = :http or sport = :https )&#x27; dst 193.233.7/24</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">List sockets <span class="keyword">in</span> all states from all socket tables but TCP.</span></span><br><span class="line">ss -a -A &#x27;all,!tcp&#x27;</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="https://tools.ietf.org/rfc/rfc793.txt">TCP协议规范RFC 793</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/05/31/Linux/network/netstat/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/31/Linux/network/netstat/" class="post-title-link" itemprop="url">netstat</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-31 15:33:52 / Modified: 16:32:19" itemprop="dateCreated datePublished" datetime="2023-05-31T15:33:52+08:00">2023-05-31</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/network/" itemprop="url" rel="index"><span itemprop="name">network</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="简介"><a class="markdownIt-Anchor" href="#简介"></a> 简介</h3>
<p>  <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-cn/Netstat">netstat</a>是一个基于命令行界面的网络实用工具，可显示当前的网络状态，包括传输控制协议层的连线状况、路由表、网络接口状态和网络协议的统计消息等。netstat命令适用于类Unix系统（如macOS、Linux、Solaris和BSD）、IBM OS/2和Windows NT操作系统家族（如Windows XP、Windows Vista、Windows 7、Windows 8和Windows 10）。<br />
  netstat可用于查找网络中的问题，并可通过计算网络流量来度量网络性能。尽管该工具仍然被包含在许多Linux发行版中，但基本都被看作过时、应被替代的工具。<br />
  在Linux上，推荐使用ss替代netstat，使用ip route替代netstat -r，使用ip -s link替代netstat -i，使用ip maddr替代netstat -g。</p>
<h3 id="输出结果"><a class="markdownIt-Anchor" href="#输出结果"></a> 输出结果</h3>
<p>  netstat输出结果</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">Active Internet connections (w/o servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State</span><br><span class="line">tcp        0     48 anonymous:ssh           desktop-7qe4e7u:9193    ESTABLISHED</span><br><span class="line">tcp        0      0 anonymous:ssh           desktop-7qe4e7u:9195    ESTABLISHED</span><br><span class="line">Active UNIX domain sockets (w/o servers)</span><br><span class="line">Proto RefCnt Flags       Type       State         I-Node   Path</span><br><span class="line">unix  3      [ ]         DGRAM                    13329    /run/systemd/notify</span><br><span class="line">unix  2      [ ]         DGRAM                    18451    /run/user/1000/systemd/notify</span><br><span class="line">unix  7      [ ]         DGRAM                    13350    /run/systemd/journal/socket</span><br><span class="line">unix  7      [ ]         DGRAM                    13616    /run/systemd/journal/dev-log</span><br><span class="line">unix  2      [ ]         DGRAM                    13506    /run/systemd/journal/syslog</span><br><span class="line">unix  2      [ ]         DGRAM                    13894</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     17379</span><br><span class="line">unix  3      [ ]         DGRAM                    13331</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     18458    /var/run/dbus/system_bus_socket</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16067</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     18531</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16071</span><br><span class="line">unix  3      [ ]         DGRAM                    14410</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16155    /run/systemd/journal/stdout</span><br><span class="line">unix  2      [ ]         DGRAM                    16220</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     18457</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16068    /run/systemd/journal/stdout</span><br><span class="line">unix  3      [ ]         DGRAM                    14411</span><br><span class="line">unix  2      [ ]         DGRAM                    14308</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     18536</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     14394    /run/systemd/journal/stdout</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16567    /var/run/dbus/system_bus_socket</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16566</span><br><span class="line">unix  2      [ ]         DGRAM                    18389</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     16154</span><br><span class="line">unix  3      [ ]         STREAM     CONNECTED     18381    /run/systemd/journal/stdout</span><br><span class="line">....</span><br></pre></td></tr></table></figure>
<p>  netstat的输出结果可以分为两个部分：</p>
<ul>
<li>一个是Active Internet connections，称为有源TCP连接，其中&quot;Recv-Q&quot;和&quot;Send-Q&quot;指%0A的是接收队列和发送队列。这些数字一般都应该是0。如果不是则表示软件包正在队列中堆积。这种情况只能在非常少的情况见到。</li>
<li>另一个是Active UNIX domain sockets，称为有源Unix域套接口(和网络套接字一样，但是只能用于本机通信，性能可以提高一倍)。Proto显示连接使用的协议,RefCnt表示连接到本套接口上的进程号,Types显示套接口的类型,State显示套接口当前的状态,Path表示连接到套接口的其它进程使用的路径名。</li>
</ul>
<h3 id="参数"><a class="markdownIt-Anchor" href="#参数"></a> 参数</h3>
<p>  可以使用man netstat查看使用手册。netstat的参数必须以连字符（-）而非斜杠（/）为前缀。并非所有平台都支持某些参数。</p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>-a</td>
<td>显示所有活动中的网络连接和电脑正在监听的TCP/UDP端口。</td>
</tr>
<tr>
<td>-b</td>
<td>显示每个应用程序所使用的网络连接和监听端口 。（仅适用于Windows XP、Windows Server 2003或更高版本的Microsoft Windows操作系统，Windows 2000或更早版本不可用。）</td>
</tr>
<tr>
<td>-b</td>
<td>同-i，但计算网络流量的总字节数。</td>
</tr>
<tr>
<td>-e</td>
<td>显示以太网统计消息，例如发送和接收的字节数及数据包数。此参数可以与-s组合使用。</td>
</tr>
<tr>
<td>-f</td>
<td>显示外部地址的完整网域名称。（仅适用于Windows Vista和更高版本的Microsoft Windows操作系统。）</td>
</tr>
<tr>
<td>-f</td>
<td>限定显示使用特定套接字（unix、inet、inet6）的地址族。</td>
</tr>
<tr>
<td>-g</td>
<td>显示多播组消息。（可能仅适用于较新的操作系统。）</td>
</tr>
<tr>
<td>-i</td>
<td>显示网络接口及统计消息。</td>
</tr>
<tr>
<td>-m</td>
<td>显示随机存取存储器统计消息。</td>
</tr>
<tr>
<td>-n</td>
<td>显示活动中的TCP连接，但主机地址和端口号以数字形式表示，不会尝试确定实际主机名。</td>
</tr>
<tr>
<td>-o</td>
<td>显示活动中的TCP连接，并包含每个连接的进程ID（PID）。根据PID，可在Windows任务管理器的“进程”选项卡中找到该应用程序。此参数可以与-a、-n和-p组合使用。如果安装了Windows修补程序，则此参数在Windows XP、Windows Server 2003和Windows 2000上可用。</td>
</tr>
<tr>
<td>-p</td>
<td>显示使用指定网络协议的连接。协议可以是TCP、UDP、TCPv6或UDPv6。如果此参数与-s组合使用，则协议可以是TCP、UDP、ICMP、IP、TCPv6、UDPv6、ICMPv6或IPv6。</td>
</tr>
<tr>
<td>-p</td>
<td>显示哪些进程正在使用哪些网络接口，类似于Microsoft Windows下的-b。（需要root权限才能执行此操作。）</td>
</tr>
<tr>
<td>-P</td>
<td>显示使用指定网络协议的连接。协议可以是IP、IPv6、ICMP、ICMPv6、IGMP、UDP、TCP或RawIP。</td>
</tr>
<tr>
<td>-r</td>
<td>显示路由表内容，与Microsoft Windows下route print命令相同。</td>
</tr>
<tr>
<td>-s</td>
<td>按网络协议显示统计消息。默认情况下，显示TCP、UDP、ICMP和IP协议的统计消息。如果Windows XP安装了IPv6协议，亦可以显示TCPv6、UDPv6、ICMPv6和IPv6协议的统计消息。-p参数可用于指定一组协议。</td>
</tr>
<tr>
<td>-t</td>
<td>仅显示TCP连接。</td>
</tr>
<tr>
<td>-u</td>
<td>仅显示UDP连接。</td>
</tr>
<tr>
<td>-W</td>
<td>显示完整主机名或IPv6地址。</td>
</tr>
<tr>
<td>-v</td>
<td>与-b组合使用时，将显示所有应用程序使用的网络连接和监听端口所涉及的组件列表。</td>
</tr>
<tr>
<td>-h</td>
<td>显示该命令的提示。</td>
</tr>
<tr>
<td>-?</td>
<td>显示该命令的提示。</td>
</tr>
<tr>
<td>/?</td>
<td>显示该命令的提示。</td>
</tr>
</tbody>
</table>
<h3 id="命令实例"><a class="markdownIt-Anchor" href="#命令实例"></a> 命令实例</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有端口 (包括监听和未监听的)</span></span><br><span class="line">netstat -a</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有 tcp 端口</span></span><br><span class="line">netstat -at</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有 udp 端口</span></span><br><span class="line">netstat -au</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">列出所有处于监听状态的 Sockets</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只显示监听端口</span></span><br><span class="line">netstat -l</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只列出所有监听 tcp 端口</span></span><br><span class="line">netstat -lt</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只列出所有监听 udp 端口</span></span><br><span class="line">netstat -lu</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">只列出所有监听 UNIX 端口</span></span><br><span class="line">netstat -lx</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示每个协议的统计信息</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示所有端口的统计信息</span></span><br><span class="line">netstat -s</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示 TCP 或 UDP 端口的统计信息</span></span><br><span class="line">netstat -st</span><br><span class="line">netstat -su</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 netstat 输出中显示 PID 和进程名称</span></span><br><span class="line">netstat -p</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">可以与其它命令一起使用，就可以添加 “PID/进程名称” 到 netstat 输出中，这样 debugging 的时候可以很方便的发现特定端口运行的程序。</span></span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">在 netstat 输出中不显示主机，端口和用户名 (host, port or user)</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">当你不想让主机，端口和用户名显示，将会使用数字代替那些名称</span></span><br><span class="line">netstat -n</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">同样可以加速输出，因为不用进行比对查询。</span></span><br><span class="line">netstat -an</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">如果只是不想让这三个名称中的一个被显示，使用以下命令</span></span><br><span class="line">netsat -a --numeric-ports</span><br><span class="line">netsat -a --numeric-hosts</span><br><span class="line">netsat -a --numeric-users</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">netstat 将每隔一秒输出网络信息</span></span><br><span class="line">netstat -c</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示系统不支持的地址族 (Address Families)</span></span><br><span class="line">netstat --verbose</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示核心路由信息</span></span><br><span class="line">netstat -r</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示数字格式，不查询主机名称</span></span><br><span class="line">netstat -rn</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">找出程序运行的端口，并不是所有的进程都能找到，没有权限的会不显示，使用 root 权限查看所有的信息。</span></span><br><span class="line">netstat -ap | grep ssh</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">找出运行在指定端口的进程</span></span><br><span class="line"> netstat -an | grep &#x27;:80&#x27;</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示网络接口列表</span></span><br><span class="line">netstat -i</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">显示详细信息，像是 ifconfig</span></span><br><span class="line">netstat -ie</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">查看连接某服务端口最多的的IP地址</span></span><br><span class="line">netstat -nat | grep &quot;192.168.1.15:22&quot; | awk &#x27;&#123;print $5&#125;&#x27;| awk -F: &#x27;&#123;print $1&#125;&#x27;|sort|uniq -c|sort -nr|head -20</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">TCP各种状态列表</span></span><br><span class="line">netstat -nat |awk &#x27;&#123;print $6&#125;&#x27;</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">先把状态全都取出来,然后使用<span class="built_in">uniq</span> -c统计，之后再进行排序</span></span><br><span class="line">netstat -nat |awk &#x27;&#123;print $6&#125;&#x27;|sort|uniq -c</span><br><span class="line">netstat -nat |awk &#x27;&#123;print $6&#125;&#x27;|sort|uniq -c|sort -rn</span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">分析access.log获得访问前10位的ip地址</span></span><br><span class="line">awk &#x27;&#123;print $1&#125;&#x27; access.log |sort|uniq -c|sort -nr|head -10</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/05/07/Linux/Security/1%E3%80%81Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/07/Linux/Security/1%E3%80%81Linux%E6%9C%8D%E5%8A%A1%E5%99%A8%E5%AE%89%E5%85%A8/" class="post-title-link" itemprop="url">Linux服务器安全</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-05-07 15:43:34 / Modified: 16:23:03" itemprop="dateCreated datePublished" datetime="2023-05-07T15:43:34+08:00">2023-05-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%AE%89%E5%85%A8/" itemprop="url" rel="index"><span itemprop="name">安全</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  安全涉及各个层面，防护策略也不尽相同。安全防护只是提高攻击成本，并不能绝对保证安全。常见的Linux服务器安全防护措施可以屏蔽绝大多数扫描，但并不能抵御有针对性的攻击。可以参考<a target="_blank" rel="noopener" href="https://downloads.cisecurity.org/#/">CIS安全基线</a>、<a target="_blank" rel="noopener" href="https://cve.mitre.org/">CVE</a>、<a target="_blank" rel="noopener" href="https://owasp.org/">OWASP</a>等。Google搜索Linux server hardening 、security baseline</p>
<h3 id="ssh"><a class="markdownIt-Anchor" href="#ssh"></a> ssh</h3>
<p>  修改默认的22端口，使用密钥登录，禁止root远程登录。</p>
<h3 id="黑白名单"><a class="markdownIt-Anchor" href="#黑白名单"></a> 黑白名单</h3>
<p>  避免使用8080、3306等各种常见的默认端口，仅开放特定的端口暴露服务。将特定IP拉黑，比如国外IP，经常访问失败的IP等。</p>
<h3 id="fail2ban"><a class="markdownIt-Anchor" href="#fail2ban"></a> fail2ban</h3>
<p>  <a target="_blank" rel="noopener" href="https://www.fail2ban.org/wiki/index.php/Main_Page">fail2ban</a>通过扫描日志并禁用有恶意访问记录的IP，比如太多的密码错误、寻找漏洞等。<a target="_blank" rel="noopener" href="https://github.com/fail2ban/fail2ban">fail2ban的github地址</a>。</p>
<h3 id="容器化"><a class="markdownIt-Anchor" href="#容器化"></a> 容器化</h3>
<p>  容器化比如docker，可以将服务隔离，将攻击范围限制在当前容器中，而不是整个服务器。</p>
<h3 id="cloudflare-tunnel"><a class="markdownIt-Anchor" href="#cloudflare-tunnel"></a> Cloudflare Tunnel</h3>
<p>  <a target="_blank" rel="noopener" href="https://www.cloudflare-cn.com/products/tunnel/">Cloudflare Tunnel</a>是一个内网穿透工具，可以暴露服务，但网络不稳定，不支持HTTP3/QUIC/UDP，需要托管域名。<a target="_blank" rel="noopener" href="https://github.com/cloudflare/cloudflared">github仓库</a>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Louis</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">52</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">65</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louis</span>
  </br>
<span>&nbsp;<a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">鄂ICP备2023000734号-1</a></span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">
  <script src="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css">


  

</body>
</html>
