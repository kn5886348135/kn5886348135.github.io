<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="https://www.goodserendipity.com/asserts/favicon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="https://www.goodserendipity.com/asserts/favicon.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://www.goodserendipity.com/asserts/favicon.png">
  <link rel="mask-icon" href="https://www.goodserendipity.com/asserts/favicon.png" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.goodserendipity.com","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="缘分天注定">
<meta property="og:url" content="https://www.goodserendipity.com/page/3/index.html">
<meta property="og:site_name" content="缘分天注定">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Louis">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.goodserendipity.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>缘分天注定</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<!-- hexo injector head_end start -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-math@4.0.0/dist/style.css">
<!-- hexo injector head_end end --></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">缘分天注定</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">古之立大事者，不惟有超世之才，亦必有坚忍不拔之志</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/07/24/Linux/Progress/1%E3%80%81%E8%BF%9B%E7%A8%8B%E9%9A%94%E7%A6%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/24/Linux/Progress/1%E3%80%81%E8%BF%9B%E7%A8%8B%E9%9A%94%E7%A6%BB/" class="post-title-link" itemprop="url">进程隔离</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-24 00:32:38 / Modified: 00:36:33" itemprop="dateCreated datePublished" datetime="2023-07-24T00:32:38+08:00">2023-07-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Progress/" itemprop="url" rel="index"><span itemprop="name">Progress</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  Namespace 技术实际上修改了应用进程看待整个计算机“视图”，即它的“视线”被操作系统做了限制，只能“看到”某些指定的内容。但对于宿主机来说，这些被“隔离”了的进程跟其他进程并没有太大区别。</p>
<p>  虚拟化技术必须由Hypervisor负责创建虚拟机，在应用对宿主机操作系统调用时，不可避免地要经过虚拟化软件的拦截和处理，增加了性能损耗，特别是计算资源、网络和磁盘I/O。</p>
<p>  基于Linux Namespace的隔离机制相比于虚拟化技术的优势是敏捷和高性能，缺点主要是隔离的不彻底。同一歌宿主机上的不同容器共用宿主机的操作系统内核，Linux内核中有很多资源和对象是不能被Namespace化的，比如时间。<br />
  容器给应用暴露出来的攻击面是相当大的，应用&quot;越狱&quot;的难度也比虚拟机低得多。</p>
<p>  在实践中可以使用Seccomp等技术对容器内部发起的所有系统调用进行过滤和甄别来进行安全加固，但是会降低容器的性能。</p>
<p>  Linux Cgroups是Linux内核中用来为进程设置资源限制的一个重要功能，全称是Linux Control Group。他最主要的作用是限制一个进程能够使用的资源上限，包括CPU、内存、磁盘、网络带宽等。Cgroup还能够对进程进行优先级设置、审计，以及将进程挂起和恢复等操作。</p>
<p>  在Linux中，Cgroups给用户暴露的操作接口是文件系统，以文件和目录的方式组织在操作系统的/sys/fs/cgroup路径下。</p>
<p>  展示Cgroup</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t cgroup</span><br></pre></td></tr></table></figure>
<p>  限制进程的CPU逻辑，在长度为 cfs_period 的一段时间内，只能被分配到总量为 cfs_quota 的 CPU 时间。</p>
<p>  跑满CPU的脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">while : ; do : ; done &amp;</span><br></pre></td></tr></table></figure>
<p>  输出</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[1] 226</span><br></pre></td></tr></table></figure>
<p>  Cgroups 对资源的限制能力也有很多不完善的地方，被提及最多的自然是 /proc 文件系统的问题。</p>
<p>  在容器里执行 top 指令，就会发现，它显示的信息居然是宿主机的 CPU 和内存数据，而不是当前容器的数据。因为/proc 文件系统不了解 Cgroups 限制的存在。</p>
<p>  Mount Namespace</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">define _GNU_SOURCE</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sys/mount.h&gt;</span> </span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sys/types.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sys/wait.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sched.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;signal.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">define STACK_SIZE (1024 * 1024)</span></span><br><span class="line">static char container_stack[STACK_SIZE];</span><br><span class="line">char* const container_args[] = &#123;</span><br><span class="line">  &quot;/bin/bash&quot;,</span><br><span class="line">  NULL</span><br><span class="line">&#125;;</span><br><span class="line"> </span><br><span class="line">int container_main(void* arg)</span><br><span class="line">&#123;  </span><br><span class="line">  printf(&quot;Container - inside the container!\n&quot;);</span><br><span class="line">  // 如果你的机器的根目录的挂载类型是 shared，那必须先重新挂载根目录</span><br><span class="line">  // mount(&quot;&quot;, &quot;/&quot;, NULL, MS_PRIVATE, &quot;&quot;);</span><br><span class="line">  mount(&quot;none&quot;, &quot;/tmp&quot;, &quot;tmpfs&quot;, 0, &quot;&quot;);</span><br><span class="line">  execv(container_args[0], container_args);</span><br><span class="line">  printf(&quot;Something&#x27;s wrong!\n&quot;);</span><br><span class="line">  return 1;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">int main()</span><br><span class="line">&#123;</span><br><span class="line">  printf(&quot;Parent - start a container!\n&quot;);</span><br><span class="line">  int container_pid = clone(container_main, container_stack+STACK_SIZE, CLONE_NEWNS | SIGCHLD , NULL);</span><br><span class="line">  waitpid(container_pid, NULL, 0);</span><br><span class="line">  printf(&quot;Parent - container stopped!\n&quot;);</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  编译这段代码并执行</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gcc -o ns ns.c</span><br><span class="line">./ns</span><br><span class="line">Parent - start a container!</span><br><span class="line">Container - inside the container!</span><br></pre></td></tr></table></figure>
<p>  Mount Namespace对容器进程视图的改变，一定是伴随着挂载操作(mount)生效的。开启Mount Namespace后必须执行mount挂载命令才会生效。虚拟机的根目录可能是share方式挂载的，在容器中mount时也会继承share方式，这样就会把容器内挂载传播到宿主机。可以在挂在前执行mount(“”, “/”, NULL, MS_PRIVATE, “”)</p>
<p>  chroot挂载根目录。<br />
  创建测试目录。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p $HOME/test</span><br><span class="line">mkdir -p $HOME/test/&#123;bin,lib64,lib&#125;</span><br><span class="line">cd $T</span><br></pre></td></tr></table></figure>
<p>  把bash命令拷贝到测试目录下。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp -v /bin/&#123;bash,ls&#125; $HOME/test/bin</span><br><span class="line">T=$HOME/test</span><br><span class="line">list=&quot;$(ldd /bin/ls | egrep -o &#x27;/lib.*\.[0-9]&#x27;)&quot;</span><br><span class="line">for i in $list; do cp -v &quot;$i&quot; &quot;$&#123;T&#125;$&#123;i&#125;&quot;; done</span><br></pre></td></tr></table></figure>
<p>  将/bin/bash进程的根目录改为测试目录</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chroot $HOME/test /bin/bash</span><br></pre></td></tr></table></figure>
<p>  Mount Namespace是基于对chroot的不断改良才被发明出来的，容器(docker)会在根目录下挂载一个完整的操作系统的文件系统。挂载在容器根目录上、用来为容器进程提供个礼后执行环境的文件系统，就是容器镜像，也叫rootfs(根文件系统)。</p>
<p>  docker项目的核心原理</p>
<ol>
<li>启用Linux Namespace配置</li>
<li>设置指定的Cgroups参数</li>
<li>切换进程的根目录(优先使用pivot_root)</li>
</ol>
<p>  rootfs只是一个操作系统所包含的文件、配置和目录，并不包含操作系统内核。在Linux操作系统中，这两部分是分开存放的，操作系统只有在开机启动时才会加载指定版本的内核镜像。<br />
如果应用程序需要配置内核参数、加载额外的内核模块，以及跟内核进行直接的交互，这些操作的对象都是宿主机操作系统的内核，对于宿主机上的所有容器都是一个“全局变量”。这是rootfs的主要缺陷之一，也造就了docker的一致性。</p>
<p>  Union File System也叫UnionFS，可以将多个不同位置的目录联合挂在到同一个目录下。Docker引入层的概念，使用UnionFS实现镜像的增量修改。</p>
<p>  容器镜像的增删改查只会作用在上面的容器层，相同的文件会覆盖下层，包括镜像层。copy-on-write。</p>
<p>  查看当前正在运行的容器PID</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect --format &#x27;&#123;&#123; .State.Pid &#125;&#125;&#x27;  4ddf4638572d</span><br></pre></td></tr></table></figure>
<p>  查看进程对应的Namespace</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l  /proc/25686/ns</span><br></pre></td></tr></table></figure>
<p>  docker exec通过加入到正在运行容器的Namespace实现进入容器的目的。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">define _GNU_SOURCE</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;fcntl.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;sched.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;unistd.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;stdlib.h&gt;</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">include &lt;stdio.h&gt;</span></span><br><span class="line"><span class="meta prompt_"> </span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">define errExit(msg) <span class="keyword">do</span> &#123; perror(msg); <span class="built_in">exit</span>(EXIT_FAILURE);&#125; <span class="keyword">while</span> (0)</span></span><br><span class="line"> </span><br><span class="line">int main(int argc, char *argv[]) &#123;</span><br><span class="line">    int fd;</span><br><span class="line">    </span><br><span class="line">    fd = open(argv[1], O_RDONLY);</span><br><span class="line">    if (setns(fd, 0) == -1) &#123;</span><br><span class="line">        errExit(&quot;setns&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    execvp(argv[2], &amp;argv[2]); </span><br><span class="line">    errExit(&quot;execvp&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>  这段代码通过open()系统调用打开指定的Namespace文件(argv[1])，将文件描述符交给setns()使用。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">gcc -o set_ns set_ns.c </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">./set_ns /proc/25686/ns/net /bin/bash</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">ifconfig</span></span><br><span class="line">eth0      Link encap:Ethernet  HWaddr 02:42:ac:11:00:02  </span><br><span class="line">          inet addr:172.17.0.2  Bcast:0.0.0.0  Mask:255.255.0.0</span><br><span class="line">          inet6 addr: fe80::42:acff:fe11:2/64 Scope:Link</span><br><span class="line">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span><br><span class="line">          RX packets:12 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:10 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">    collisions:0 txqueuelen:0 </span><br><span class="line">          RX bytes:976 (976.0 B)  TX bytes:796 (796.0 B)</span><br><span class="line"> </span><br><span class="line">lo        Link encap:Local Loopback  </span><br><span class="line">          inet addr:127.0.0.1  Mask:255.0.0.0</span><br><span class="line">          inet6 addr: ::1/128 Scope:Host</span><br><span class="line">          UP LOOPBACK RUNNING  MTU:65536  Metric:1</span><br><span class="line">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span><br><span class="line">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span><br><span class="line">   collisions:0 txqueuelen:1000 </span><br><span class="line">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span><br></pre></td></tr></table></figure>
<p>  ifconfig查看网络设备时，看到的是docker容器中的网卡。</p>
<p>  Docker Volume允许将宿主机上指定的目录或者文件挂载到容器里面进行读取和修改操作。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/07/24/Shell/3%E3%80%81awk/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/24/Shell/3%E3%80%81awk/" class="post-title-link" itemprop="url">sed</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-24 00:30:33" itemprop="dateCreated datePublished" datetime="2023-07-24T00:30:33+08:00">2023-07-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/07/24/Shell/2%E3%80%81grep/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/24/Shell/2%E3%80%81grep/" class="post-title-link" itemprop="url">sed</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-07-24 00:30:23" itemprop="dateCreated datePublished" datetime="2023-07-24T00:30:23+08:00">2023-07-24</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/07/24/Shell/1%E3%80%81sed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/07/24/Shell/1%E3%80%81sed/" class="post-title-link" itemprop="url">sed</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-07-24 00:30:11 / Modified: 00:31:38" itemprop="dateCreated datePublished" datetime="2023-07-24T00:30:11+08:00">2023-07-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  Sed 代表 Strem Editor(流编辑器),是操作、过滤和转换文本内容的强大工具。Sed 可以从文件和管道中读取输入。</p>
<h3 id="sed-基本语法"><a class="markdownIt-Anchor" href="#sed-基本语法"></a> Sed 基本语法</h3>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sed [options] &#123;sed-commands&#125; &#123;input-file&#125;</span><br><span class="line">sed 每次从 input-file 中读取一行记录，并在该记录上执行 sed-commands</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/41%E3%80%81Dinic%20Algorithm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/41%E3%80%81Dinic%20Algorithm/" class="post-title-link" itemprop="url">Dinic Algorithm</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:47:55" itemprop="dateCreated datePublished" datetime="2023-06-03T01:47:55+08:00">2023-06-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/40%E3%80%81Huffman%20Coding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/40%E3%80%81Huffman%20Coding/" class="post-title-link" itemprop="url">Huffman Coding</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:45:56" itemprop="dateCreated datePublished" datetime="2023-06-03T01:45:56+08:00">2023-06-03</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/28%E3%80%81Skip%20List/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/28%E3%80%81Skip%20List/" class="post-title-link" itemprop="url">Skip List</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:40:13" itemprop="dateCreated datePublished" datetime="2023-06-03T01:40:13+08:00">2023-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-07 17:27:13" itemprop="dateModified" datetime="2023-08-07T17:27:13+08:00">2023-08-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Skip_list">SkipList</a>是一种概率数据结构，允许 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 平均搜索复杂度以及 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 在 n 个元素的有序序列中插入的平均复杂度。由William Pugh在<a target="_blank" rel="noopener" href="https://www.epaperpress.com/sortsearch/download/skiplist.pdf">Skip lists: a probabilistic alternative to balanced trees</a>发表。它可以获得排序数组（用于搜索）的最佳功能，同时保持允许插入的类似链表的结构，这对于静态数组来说是不可能的。通过维护子序列的链接层次结构可以实现快速搜索，每个连续的子序列跳过的元素比前一个序列少。从最稀疏的子序列开始搜索，直到找到两个连续的元素，一个小于或等于所搜索的元素，一个大于或等于所搜索的元素。通过链接的层次结构，这两个元素链接到下一个最稀疏子序列的元素，继续搜索直到最终在完整序列中搜索到。跳过的元素可以按概率或确定性进行选择，前者更为常见。</p>
<h3 id="跳表的特点"><a class="markdownIt-Anchor" href="#跳表的特点"></a> 跳表的特点</h3>
<ol>
<li>跳表维护了一个多层级的链表结构，搜索二叉树无关</li>
<li>利用随机概率分布来使得高层索引可以无视数据规律，做到整体性能优良</li>
<li>思想是所有有序表中最先进的</li>
<li>结构简单就是多级单链表</li>
<li>查询平均时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，插入和修改的期望时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，期望空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，最坏空间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>n</mi><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(nlogn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal">n</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>，<a target="_blank" rel="noopener" href="https://oi-wiki.org/ds/skiplist/">SkipList的复杂度证明</a></li>
<li>范围查找时，跳表的时间复杂度优于红黑树</li>
</ol>
<h3 id="跳表的实现"><a class="markdownIt-Anchor" href="#跳表的实现"></a> 跳表的实现</h3>
<ol>
<li>
<p>使用一个list保存整列的节点</p>
<ol>
<li>新增
<ul>
<li>抛硬币决定当前节点node的高度</li>
<li>从上到下，从左往右查找小于key的节点pre</li>
<li>连接pre和node节点并填充node高度以下的节点</li>
</ul>
</li>
<li>删除
<ul>
<li>判断要删除的key这个节点是否存在</li>
<li>每一层找到最右小于key的节点pre</li>
<li>pre在当前层指向pre的下一个节点</li>
</ul>
</li>
<li>查询
<ul>
<li>从上到下，从左往右查找</li>
</ul>
</li>
</ol>
</li>
<li>
<p>使用上下左右4个节点表达链表之间的关系</p>
</li>
<li>
<p>JDK中ConCurrentSkipListMap对SkipList的实现</p>
</li>
</ol>
<p>  Java 8 ConCurrentSkipListMap是对SkipList的一个变种的、无锁并发实现，无锁并发相关的论文Tim Harris <a target="_blank" rel="noopener" href="https://www.cl.cam.ac.uk/research/srg/netos/papers/2001-caslists.pdf">A pragmatic implementation of non-blocking linked lists</a>和Maged Michael <a target="_blank" rel="noopener" href="https://docs.rs/crate/crossbeam/0.2.4/source/hash-and-skip.pdf">High Performance Dynamic Lock-Free Hash Tables and List-Based Sets</a>，<a target="_blank" rel="noopener" href="http://www.cse.yorku.ca/~ruppert/Mikhail.pdf">Mikhail Fomitchev的论文</a>，<a target="_blank" rel="noopener" href="https://www.cl.cam.ac.uk/techreports/UCAM-CL-TR-579.pdf">Keir Fraser的论文</a>, <a target="_blank" rel="noopener" href="https://research.chalmers.se/en/person/phs">Hakan Sundell的论文</a></p>
<h4 id="子数组累加和在某个区间的数量"><a class="markdownIt-Anchor" href="#子数组累加和在某个区间的数量"></a> 子数组累加和在某个区间的数量</h4>
<p>  给定一个数组arr，和两个整数a和b（a&lt;=b）。求arr中有多少个子数组，累加和在[a,b]这个范围上，返回达标的子数组数量。</p>
<blockquote>
<ol>
<li>归并排序</li>
<li>前缀和数组</li>
<li>暴力O(N<sup>3</sup>)</li>
<li>改写SBT</li>
</ol>
</blockquote>
<h4 id="滑动窗口的中位数"><a class="markdownIt-Anchor" href="#滑动窗口的中位数"></a> 滑动窗口的中位数</h4>
<p>  求滑动窗口每一个窗口状态的中位数</p>
<blockquote>
<ol>
<li>L是滑动窗口最左位置、R是滑动窗口最右位置，一开始LR都在数组左侧</li>
<li>任何一步都可能R往右动，表示某个数进了窗口</li>
<li>任何一步都可能L往右动，表示某个数出了窗口</li>
</ol>
</blockquote>
<h4 id="设计thetalogn的数据结构"><a class="markdownIt-Anchor" href="#设计thetalogn的数据结构"></a> 设计<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>的数据结构</h4>
<p>  设计一个结构包含如下方法，要求时间复杂度都是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></p>
<blockquote>
<ol>
<li>void add(int index, int num)：把num加入到index位置</li>
<li>int get(int index) ：取出index位置的值</li>
<li>void remove(int index) ：把index位置上的值删除</li>
</ol>
</blockquote>
<h3 id="改写有序表的核心"><a class="markdownIt-Anchor" href="#改写有序表的核心"></a> 改写有序表的核心</h3>
<ol>
<li>增加某个数据项可以支持题目，例如子数组累加和在某个区间的数量的问题</li>
<li>有序表一定要保持内部参与排序的key不重复</li>
<li>平衡性调整时，正确更新增加的数据项</li>
<li>在搜索二叉树上实现</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/27%E3%80%81Size%20Balanced%20Tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/27%E3%80%81Size%20Balanced%20Tree/" class="post-title-link" itemprop="url">Size Balanced Tree</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:36:47" itemprop="dateCreated datePublished" datetime="2023-06-03T01:36:47+08:00">2023-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-01 00:19:46" itemprop="dateModified" datetime="2023-08-01T00:19:46+08:00">2023-08-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  <a target="_blank" rel="noopener" href="http://wcipeg.com/wiki/Size_Balanced_Tree">Size Balanced Tree</a> (SBT) 是由中国 OI 选手陈启峰在 2007 年提出的一种自平衡二叉搜索树 (Self-Balanced Binary Search Tree, SBBST), 通过检查子树的节点数量进行自身的平衡维护。相比于红黑树，AVL 等主流自平衡二叉搜索树而言，Size Balanced Tree 支持在 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>log</mi><mo>⁡</mo><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(\log n)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mop">lo<span style="margin-right:0.01389em;">g</span></span><span class="mspace" style="margin-right:0.16666666666666666em;"></span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span> 的时间复杂度内查询某个键值在树中的排名 (rank)。</p>
<h3 id="size-balanced-tree定义"><a class="markdownIt-Anchor" href="#size-balanced-tree定义"></a> Size Balanced Tree定义</h3>
<p>  Size Balance Tree是一颗二叉搜索树，每个节点 Node 仅需要多维护一个整数字段 size, 用于储存以 Node 为根的子树中节点的个数。</p>
<h3 id="size-balance-tree性质"><a class="markdownIt-Anchor" href="#size-balance-tree性质"></a> Size Balance Tree性质</h3>
<ol>
<li>每一个叔叔节点为头的树，节点个数都不少于其任何一个侄子节点</li>
<li>从底层被影响节点开始向上做路径上每个节点检查</li>
<li>与AVL树一样，有四种违规类型：LL(一次右旋)、RR(一次左旋)、LR(左旋右旋)、RL(右旋左旋)</li>
<li>与AVL树不同的是，每轮经过调整后，检查子节点发生变化的节点</li>
</ol>
<table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>解释</th>
<th>操作</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>LL</td>
<td>size(cur.left.left) &gt; size(cur.right)</td>
<td>cur右旋并递归检查cur,cur.left是否违规</td>
</tr>
<tr>
<td>2</td>
<td>LR</td>
<td>size(cur.left.right)&gt;size(cur.right)</td>
<td>cur.left左旋，cur.left.right右旋，并递归检查cur、cur.left、cur.left.right</td>
</tr>
<tr>
<td>3</td>
<td>RR</td>
<td>size(cur.right.right)&gt;size(cur.left)</td>
<td>cur左旋并递归检查cur,cur.right</td>
</tr>
<tr>
<td>4</td>
<td>RL</td>
<td>size(cur.right.left)&gt;size(cur.left)</td>
<td>cur.right右旋，cur.right.left左旋，并递归检查cur、cur.right、cur.right.left</td>
</tr>
</tbody>
</table>
<h3 id="size-balance-tree的平衡性"><a class="markdownIt-Anchor" href="#size-balance-tree的平衡性"></a> Size Balance Tree的平衡性</h3>
<blockquote>
<p>T.left = A, T.right = B<br />
size(T.left) ≥ size(T.right.left), size(T.right.right)<br />
size(T.right) ≥ size(T.left.left), size(T.left.right)</p>
</blockquote>
<p>  假设size(A)=n，B节点的两个子节点数都小于n，则size(B) ≤ 2n。则整颗树的高度仍然是logN的水平，没有avl tree的平衡性好。<br />
  Size Balanced tree只能保证两个子树的size不超过2倍，时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>有严格的数学证明，</p>
<h3 id="sb树在使用时候的改进"><a class="markdownIt-Anchor" href="#sb树在使用时候的改进"></a> SB树在使用时候的改进</h3>
<ol>
<li>删除时候可以不用检查平衡性
<ul>
<li>假设size-balanced tree的节点数是N，删除所有的左节点或者右节点后退化成链表时，高度为logN，是最差时间复杂度。后续如果增加节点，马上递归调整成平衡状态。</li>
</ul>
</li>
<li>把平衡性的调整放在插入的时候</li>
<li>子节点发生变化就需要递归检查的特性，AVL Tree，Red-Black Tree等没有</li>
<li>可以在节点上封装别的数据项，来增加功能</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/03/DataStructuresAndAlgorithms/26%E3%80%81AVL%20tree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/03/DataStructuresAndAlgorithms/26%E3%80%81AVL%20tree/" class="post-title-link" itemprop="url">AVL tree</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-03 01:33:10" itemprop="dateCreated datePublished" datetime="2023-06-03T01:33:10+08:00">2023-06-03</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-04 11:45:59" itemprop="dateModified" datetime="2023-08-04T11:45:59+08:00">2023-08-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>  <a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/AVL_tree">AVL 树</a>，是一种自平衡的二叉搜索树，两个子树的高度差不超过1。经典的搜索二叉树，新增、删除、修改节点后没有平衡功能，在数据状况很差的时候退化成链表，同时性能退化。树上没有重复的用来排序的key值，如果有重复节点的需求，可以在一个节点内部增加数据项。</p>
<h3 id="搜索二叉树查询"><a class="markdownIt-Anchor" href="#搜索二叉树查询"></a> 搜索二叉树查询</h3>
<ol>
<li>如果当前节点的value==key，返回true</li>
<li>如果当前节点的value &lt; key，当前节点向左移动</li>
<li>如果当前节点的value &gt; key，当前节点向右移动</li>
<li>如果当前节点变成null，返回false</li>
</ol>
<h3 id="搜索二叉树新增"><a class="markdownIt-Anchor" href="#搜索二叉树新增"></a> 搜索二叉树新增</h3>
<p>  和查询过程一样，但当前节点滑到空的时候，就插入在这里</p>
<h3 id="搜索二叉树删除"><a class="markdownIt-Anchor" href="#搜索二叉树删除"></a> 搜索二叉树删除</h3>
<ol>
<li>先找到key所在的节点</li>
<li>如果该节点没有左孩子、没有右孩子，直接删除即可</li>
<li>如果该节点有左孩子、没有右孩子，直接用左孩子顶替该节点</li>
<li>如果该节点没有左孩子、有右孩子，直接用右孩子顶替该节点</li>
<li>如果该节点有左孩子、有右孩子，用该节点后继节点(中序遍历该节点的下一个节点)或者前驱节点顶替该节点(右节点的最左节点替换当前节点或者左节点的最右节点替换当前节点)</li>
</ol>
<h3 id="avl树的定义"><a class="markdownIt-Anchor" href="#avl树的定义"></a> AVL树的定义</h3>
<ol>
<li>左右子树的高度差不超过1</li>
<li>根节点为空</li>
<li>左子树、右子树都是AVL树</li>
</ol>
<h3 id="avl树-size-balanced树-红黑树的相同点"><a class="markdownIt-Anchor" href="#avl树-size-balanced树-红黑树的相同点"></a> AVL树、Size-Balanced树、红黑树的相同点</h3>
<ol>
<li>都是搜索二叉树</li>
<li>插入、删除、查询操作同经典搜索二叉树</li>
<li>使用调整的基本动作都只有左旋、右旋</li>
<li>插入、删除、修改时，从最底层被影响到的节点开始，对往上路径的节点做平衡性检查</li>
<li>因为只对一条向上路径的每个节点做<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mn>1</mn><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(1)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord">1</span><span class="mclose">)</span></span></span></span>的检查和调整，所以可以做到时间复杂度<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logN)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span></li>
</ol>
<h3 id="avl树-sb树-红黑树的不同点"><a class="markdownIt-Anchor" href="#avl树-sb树-红黑树的不同点"></a> AVL树、SB树、红黑树的不同点</h3>
<ol>
<li>平衡性的约束不同
<ul>
<li>AVL树最严格(每次添加、删除节点都会检查)</li>
<li>SB树稍宽松(删除节点时可以不调整平衡性，只在增加节点的时候递归调整平衡性)</li>
<li>红黑树最宽松(任何平衡都不会超过3次调整)</li>
<li><font color="red">查找密集型的数据结构更适合使用AVL树?</font></li>
</ul>
</li>
<li>插入、删除和经典搜索二叉树一样，但是各自的平衡性定义不同，左旋右旋的判断条件不同。</li>
<li>红黑树最多旋转3次达到平衡，SB树在删除时可以不需要调整平衡性，AVL不会控制旋转次数</li>
</ol>
<h3 id="应用场景"><a class="markdownIt-Anchor" href="#应用场景"></a> 应用场景</h3>
<ol>
<li>Windows对进程地址空间的管理，Windows NT内核，solaris</li>
<li>红黑树用于C++的STL中map、set的实现，Java的TreeMap、TreeSet，Java8的HashMap，CFS(Completely Fair Scheduler)进程调度算法中的vruntime，高分辨率计时器，ext3文件系统跟踪红黑树中的目录条目，虚拟内存的结构管理(VMA)，多路复用技术的Epoll的核心结构是红黑树和双向链表，加密秘钥和网络数据包均由红黑树跟踪。nginx用红黑树管理timer。</li>
<li>B/B+树用于磁盘文件数据索引和数据库索引</li>
<li>Trie树不是平衡树，用于词频统计和排序大量的字符串。搜索引擎的suggest、IDE的自动补全、通讯录的自动补全、IP路由、DNA序列匹配</li>
</ol>
<h3 id="avl树新增-删除-修改"><a class="markdownIt-Anchor" href="#avl树新增-删除-修改"></a> AVL树新增、删除、修改</h3>
<ol>
<li>最严格的平衡性，任何节点左树高度和右树高度差不超过1</li>
<li>往上沿途检查每个节点时，都去检查四种违规情况：LL、RR、LR、RL</li>
<li>不同情况虽然看起来复杂，但是核心点是：LL（做一次右旋）、RR（做一次左旋）、LR和RL（利用旋转让底层那个上到顶部）,某一个节点不平衡都是LL、LR、RR、RL四种破坏平衡性的类型之一，所有父节点全部检查一次</li>
</ol>
<p>AVL Tree新增节点</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>解释</th>
<th>操作</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>LL</td>
<td>左子树的左子树太长</td>
<td>当前节点右旋</td>
</tr>
<tr>
<td>2</td>
<td>LR</td>
<td>左子树的右子树太长</td>
<td>当前节点的左子树左旋，然后右旋，使左节点的右节点来到当前节点</td>
</tr>
<tr>
<td>3</td>
<td>RR</td>
<td>右子树的右子树太长</td>
<td>当前节点左旋</td>
</tr>
<tr>
<td>4</td>
<td>RL</td>
<td>右子树的左子树太长</td>
<td>当前节点的右子树右旋，然后左旋，使右节点的左节点来到当前节点</td>
</tr>
<tr>
<td>5</td>
<td>LL+LR</td>
<td></td>
<td>按照LL处理，直接右旋，按照LR处理可能高度差仍然大于2</td>
</tr>
<tr>
<td>6</td>
<td>RR+RL</td>
<td></td>
<td>按照RR处理，直接左旋</td>
</tr>
</tbody>
</table>
<p>AVL Tree删除节点</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>类型</th>
<th>解释</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>没有左右</td>
<td>父节点往上都检查</td>
</tr>
<tr>
<td>2</td>
<td>有左无右</td>
<td>父节点指向左节点X，X往上都检查</td>
</tr>
<tr>
<td>3</td>
<td>有右无左</td>
<td>父节点指向右节点X，X往上都检查</td>
</tr>
<tr>
<td>4</td>
<td>有左有右</td>
<td>右节点的最左节点X替换当前节点，X的父节点往上检查或者左节点的最右节点X替换当前节点，X的父节点往上检查</td>
</tr>
</tbody>
</table>
<p>  <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/wiki/%E5%8F%AF%E6%8C%81%E4%B9%85%E5%8C%96%E7%BA%BF%E6%AE%B5%E6%A0%91">可持久化线段树</a>(在中国信息学奥林匹克竞赛中，由于引入者黄嘉泰姓名的缩写与前中共中央总书记、国家主席胡锦涛(H.J.T.)相同，因此这种数据结构也可被称为总书记树或主席树)、<a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/2-3-4%E6%A0%91">234树</a>、<a target="_blank" rel="noopener" href="http://wcipeg.com/wiki/Size_Balanced_Tree">Size-Balanced树</a>、<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/Red%E2%80%93black_tree">红黑树</a>、<a target="_blank" rel="noopener" href="https://en.wikipedia.org/wiki/AVL_tree">AVL树</a>的平衡性不一样，时间复杂度都是<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><msub><mi>g</mi><mn>2</mn></msub><mi>N</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(log_2N)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord"><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="msupsub"><span class="vlist-t vlist-t2"><span class="vlist-r"><span class="vlist" style="height:0.30110799999999993em;"><span style="top:-2.5500000000000003em;margin-left:-0.03588em;margin-right:0.05em;"><span class="pstrut" style="height:2.7em;"></span><span class="sizing reset-size6 size3 mtight"><span class="mord mtight">2</span></span></span></span><span class="vlist-s">​</span></span><span class="vlist-r"><span class="vlist" style="height:0.15em;"><span></span></span></span></span></span></span><span class="mord mathnormal" style="margin-right:0.10903em;">N</span><span class="mclose">)</span></span></span></span>。<br />
  <a target="_blank" rel="noopener" href="https://zh.wikipedia.org/zh-hans/%E4%BC%B8%E5%B1%95%E6%A0%91">伸展树</a>(Splay Tree)是一种能够自我平衡的二叉查找树，它能在均摊<span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi mathvariant="normal">Θ</mi><mo stretchy="false">(</mo><mi>l</mi><mi>o</mi><mi>g</mi><mi>n</mi><mo stretchy="false">)</mo></mrow><annotation encoding="application/x-tex">\Theta(logn)</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:1em;vertical-align:-0.25em;"></span><span class="mord">Θ</span><span class="mopen">(</span><span class="mord mathnormal" style="margin-right:0.01968em;">l</span><span class="mord mathnormal">o</span><span class="mord mathnormal" style="margin-right:0.03588em;">g</span><span class="mord mathnormal">n</span><span class="mclose">)</span></span></span></span>的时间内完成基于伸展（Splay）操作的插入、查找、修改和删除操作。它是由丹尼尔·斯立特（Daniel Sleator）和罗伯特·塔扬在1985年发明的。<br />
  <a target="_blank" rel="noopener" href="https://github.com/krareT/trkdb/wiki/Dynamic-Patricia-Trie">Patricia Trie</a><br />
  mysql等关系数据库用到的有序表比如B+Tree无法拆分成分布式结构，所有都是单实例的。<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/group-replication.html">mysql8的分布式功能</a>怎么理解？<br />
  <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/454080520"><font color="red">AVL Tree的优化</font></a>(待验证)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="https://www.goodserendipity.com/2023/06/02/DataStructuresAndAlgorithms/25%E3%80%81%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E7%B1%BB%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Louis">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="缘分天注定">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/06/02/DataStructuresAndAlgorithms/25%E3%80%81%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E7%B1%BB%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">资源限制类问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-06-02 22:04:53" itemprop="dateCreated datePublished" datetime="2023-06-02T22:04:53+08:00">2023-06-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-07-26 16:32:55" itemprop="dateModified" datetime="2023-07-26T16:32:55+08:00">2023-07-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E4%B8%8E%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构与算法</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="资源限制类问题技巧"><a class="markdownIt-Anchor" href="#资源限制类问题技巧"></a> 资源限制类问题技巧</h3>
<ol>
<li>布隆过滤器用于集合的建立与查询，并可以节省大量空间</li>
<li>一致性哈希解决数据服务器的负载管理问题</li>
<li>利用并查集结构做岛问题的并行计算</li>
<li>哈希函数可以把数据按照种类均匀分流</li>
<li>位图解决某一范围上数字的出现情况，并可以节省大量空间</li>
<li>利用分段统计思想、并进一步节省大量空间</li>
<li>利用堆、外排序来做多个处理单元的结果合并</li>
</ol>
<h4 id="hash函数把数据按照种类均匀分流"><a class="markdownIt-Anchor" href="#hash函数把数据按照种类均匀分流"></a> hash函数把数据按照种类均匀分流</h4>
<ol>
<li>32位无符号整数的范围是0~4,294,967,295，现在有一个正好包含40亿个无符号整数的文件，可以使用最多1GB的内存，怎么找到出现次数最多的数？</li>
</ol>
<p>  将每一个数对400取模，分别存到400个小文件中。相同的数一定在同一个文件中，并且因为hash的均匀离散特性，每个文件中最多1000W数据(即使超过1000W，也不会超过太多)，内存不超过1G。另外新建小文件记录每个数和出现的次数的键值对。取出每一个文件中出现次数最多的数，取最大值。</p>
<ol start="2">
<li>在上一个问题中，如果某一个数字出现了2000W次？</li>
</ol>
<p>  将每一个数对400取模后直接写入整数和它出现的次数的键值对，取出每一个文件中出现次数最多的数，取最大值。</p>
<h4 id="位图找出不存在的无符号整数"><a class="markdownIt-Anchor" href="#位图找出不存在的无符号整数"></a> 位图找出不存在的无符号整数</h4>
<ol start="3">
<li>32位无符号整数的范围是0~4,294,967,295，现在有一个正好包含40亿个无符号整数的文件，所以在整个范围中必然存在没出现过的数。可以使用最多1GB的内存，怎么找到所有未出现过的数？</li>
</ol>
<p>  使用bitmap或者数组保存0~4,294,967,295内的无符号整数，1GB=2<sup>3</sup> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 2<sup>10</sup> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 2<sup>10</sup> <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> 2<sup>10</sup> bit = 2<sup>33</sup> bit，是可以保存所有0~4,294,967,295的无符号整数。遍历给定的文件，拿到某一个整数index，在bitmap的offset为index的二进制位修改为1，最后取出bitmap中所有二进制位为0的数，bitmap的所有二进制位都是0则是整数0。(2<sup>32</sup>长度的bit数组arr，出现过的数字num，将arr[num]标记成1，最后将没有出现过的数字列出即可。如果arr[index]==0，则index没有出现过。)<br />
  Set，需要约16G内存，位图，不超过1G内存。2<sup>32</sup>     bit = 2<sup>29</sup>     Byte = 2<sup>19</sup>     KB = 2<sup>9</sup>      MB = 2<sup>-1</sup>     GB</p>
<ol start="4">
<li>32位无符号整数的范围是0~4294967295，现在有40亿个无符号整数，可以使用最多1GB的内存，找出所有出现了两次的数。</li>
</ol>
<p>  准备2<sup>33</sup>长度的bit数组arr，对任意无符号整数index，arr[2<em>index]、arr[2</em>index+1]表示index出现的次数</p>
<table>
<thead>
<tr>
<th>序号</th>
<th>arr[2 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> index]</th>
<th>arr[2 <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>×</mo></mrow><annotation encoding="application/x-tex">\times</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.66666em;vertical-align:-0.08333em;"></span><span class="mord">×</span></span></span></span> index + 1]</th>
<th>含义</th>
</tr>
</thead>
<tbody>
<tr>
<td>1</td>
<td>0</td>
<td>0</td>
<td>没有出现index</td>
</tr>
<tr>
<td>2</td>
<td>0</td>
<td>1</td>
<td>index出现1次</td>
</tr>
<tr>
<td>3</td>
<td>1</td>
<td>0</td>
<td>index出现2次</td>
</tr>
<tr>
<td>4</td>
<td>1</td>
<td>1</td>
<td>index出现3次及以上</td>
</tr>
</tbody>
</table>
<h4 id="分段统计"><a class="markdownIt-Anchor" href="#分段统计"></a> 分段统计</h4>
<ol start="5">
<li>32位无符号整数的范围是0~4,294,967,295，现在有一个正好包含40亿个无符号整数的文件，所以在整个范围中必然存在没出现过的数。内存限制为 10MB(3KB)，怎么找到任意一个没有出现的整数。</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 假设数组长度为10</span></span><br><span class="line"><span class="type">int</span>[] arr = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">179</span>; <span class="comment">// i &amp;lt; 10 * 32</span></span><br><span class="line"><span class="type">int</span> <span class="variable">status</span> <span class="operator">=</span> (arr[i / <span class="number">32</span>] &amp; (<span class="number">1</span> &lt;&lt; (i % <span class="number">32</span>))) == <span class="number">0</span> ? <span class="number">0</span> : <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<p>  程序运行消耗的内存肯定不止3KB，这里的3KB是指用于分段的局部变量内存大小。<br />
  <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>512</mn><mo>×</mo><mn>4</mn></mrow><annotation encoding="application/x-tex">512 \times 4</annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height:0.72777em;vertical-align:-0.08333em;"></span><span class="mord">5</span><span class="mord">1</span><span class="mord">2</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span><span class="mbin">×</span><span class="mspace" style="margin-right:0.2222222222222222em;"></span></span><span class="base"><span class="strut" style="height:0.64444em;vertical-align:0em;"></span><span class="mord">4</span></span></span></span> Byte &lt; 3KB，将0-2<sup>32</sup>-1均分成512份，则每一份都应该有2<sup>23</sup> = 8388608个无符号整数。准备数组arr，遍历整个文件，当前无符号整数num对512取模，结果为index，arr[index]记录每一个分段的无符号整数的个数。根据鸽笼原理，必有某一个arr[i]小于2<sup>23</sup>。继续拆分成512份，适当时候可以使用bitmap找到一个没有出现的无符号整数。</p>
<p>  0~2<sup>32</sup>-1一共2<sup>32</sup>个数字，每个比特位为1和为0的无符号整数个数一定是相同的。遍历40亿个无符号整数，从最高位开始，每次取个数较小的比特位并记录。最多32次就可以获取某一个不存在的无符号整数。<br />
<font color=red>// TODO 证明</font></p>
<ol start="6">
<li>只能申请几个有限的变量，找到40亿个数的文件中没有出现的(1-2<sup>32</sup>-1)范围内的数字？<br />
  准备left、mid、right将2<sup>32</sup>二分，个数较少的那部分一定有不存在的无符号整数。最多经过32次二分就可以得出结果。</li>
</ol>
<h3 id="布隆过滤器"><a class="markdownIt-Anchor" href="#布隆过滤器"></a> 布隆过滤器</h3>
<ol start="7">
<li>有一个包含100亿个URL的大文件，假设每个URL占用64Bit，请找出其中所有重复的URL。</li>
</ol>
<p>  布隆过滤器存在误判的可能，hash签名不会误判但需要更多的内存。将所有URL通过一到两次hash到若干个(10000)小文件中，最后统计小文件中重复的URL。</p>
<ol start="8">
<li>某搜索公司一天的用户搜索词汇是海量的(百亿数据量)，请设计一种求出每天热门Top100词汇的可行办法。</li>
</ol>
<p>  大根堆是不可以的，没法获取每一个搜索词汇的频次，100亿URL的大根堆超过单机处理内存上限。可以使用hash或者布隆过滤器拿到所有搜索词出现的次数，再取出top100。使用前缀树、后缀树统计频次，利用重复的前缀节省空间。如果是中文、日文这种超大字符集的语言可以使用双数组字典树(Double-Array Trie)。</p>
<h3 id="分段统计-2"><a class="markdownIt-Anchor" href="#分段统计-2"></a> 分段统计</h3>
<ol start="9">
<li>
<p>32位无符号整数的范围是0~4294967295，现在有40亿个无符号整数，可以使用最多3K的内存，怎么找到这40亿个整数的中位数？<br />
1、准备int[] arr = new int[512]<br />
2、统计将40亿个数按照512个一组分成若干份，统计每一组的频次<br />
3、累加每组的频次，直到20亿</p>
</li>
<li>
<p>32位无符号整数的范围是0~4294967295，现在有40亿个无符号整数，可以使用最多3K的内存，怎么找到这40亿个整数的上中位数(偶数个的时候前一个)？<br />
1、准备int[] arr = new int[512]<br />
2、统计将40亿个数按照512个一组分成若干份，统计每一组的频次<br />
3、累加每组的频次，直到20亿</p>
</li>
</ol>
<h3 id="堆排序"><a class="markdownIt-Anchor" href="#堆排序"></a> 堆排序</h3>
<ol start="11">
<li>32位无符号整数的范围是0~4294967295，有一个10G大小的文件，每一行都装着这种类型的数字，整个文件是无序的，给你5G的内存空间，请你输出一个10G大小的文件，就是原文件所有数字排序的结果。</li>
</ol>
<p>  用自定义的堆或者数组保存前k个最小的无符号整数并排序，记录每个整数和出现的次数的键值对。若干次循环将整个文件的无符号整数排序。外部排序(分布式合并排序)可以忽视单机内存限制，二项堆(堆上堆、二维堆)也有单机内存限制。</p>
<ol>
<li>将源文件复制一份</li>
<li>自定义一个小根堆，大小为2<sup>28</sup>次，正好1GB大小的Integer数据</li>
<li>从文件中读取逐行读取数字<br />
a. 如果堆没有满则进堆，在文件中删除这个数字，并记录数字和对应的频次<br />
b. 如果堆满并且小于堆中最大的数则进堆并且删除堆中最大的数，在文件中删除这个数字，并记录数字和对应的频次。更新堆中最大的数和位置。<br />
c. 如果堆满并且大于堆中的最大的数则继续读取文件中的数字并重复步骤3</li>
<li>文件读取完以后将堆中的数字读出并按照频次输出到目标文件</li>
<li>循环步骤3、4直到文件中没有数据</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Louis</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">15</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">86</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2023</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Louis</span>
  </br>
<span>&nbsp;<a target="_blank" rel="noopener" href="http://beian.miit.gov.cn/">鄂ICP备2023000734号-1</a></span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  
      
<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/katex.min.css">
  <script src="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/katex@0/dist/contrib/copy-tex.min.css">


  

</body>
</html>
